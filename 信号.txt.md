## 步进电机控制

给定总路程长度、角度（脉冲数）和坐标的关系表，要求输入坐标，电机运动到指定坐标点。

### Input模块(适用于五键输入)

- 通过按键输入得到电机编号和坐标值并输出。
- 5键{Left,Right,Enter,Up,Down}：通过Left/Right键切换电机/坐标位，通过Up/Down键改变电机编号/坐标值，通过Enter键确认执行。
- 输入：sysclk,Left,Right,Enter,Up,Down
  - sysclk为系统时钟，上升沿有效；
  - Left,Right,Enter,Up,Down为输入控制，假设下降沿有效。


- 输出：Motor,Value,inputLock

  - Motor，电机编号输出到Control模块和Pulse模块；

    6bit，比特位为1表示该电机选中，1比特位不超过1个，后续用组合逻辑选择电机发送信号。

  - Value，坐标值输出到Control模块；

    比特位数根据输入位移位数确定

    1. 12bit，其中11:8表示百位，7:4表示十位，3:0表示个位，方便进行查表；
    2. 10bit，即0~1023，方便计算位移。

  - inputLock输出到Control模块。

### Control模块

- 根据输入产生脉冲数PulseNum和方向信号DR。

- 保存上次电机坐标，和输入坐标比较，计算出位移值和方向信号。

- 存储给定关系表MotorValue->PulseNum，用时查表将输入位移值转换为脉冲数。

- 输入：sysclk,rst,initFlag,Motor,Value,InputLock,Busy

  - sysclk为系统时钟，上升沿有效；
  - rst为复位信号，下降沿有效；
  - Motor,Value,inputLock为Input模块输出，inputLock低电平有效，即代表Input操作已完成；
  - initFlag为Pulse模块输出，高电平代表原点已标定；
  - Busy为Pulse模块输出，低电平代表此时Pulse模块可对控制信号做出响应。

- 输出：PulseNum,DR

  - 输出PulseNum，即脉冲数到Pulse模块；

    比特位数与存储表有关。

  - 直接输出DR，以控制电机方向，高电平表示反转。



### Pulse模块

- 根据输入信号产生脉冲信号。
- initFlag为假时不断发送脉冲以驱动电机标定原点，initFlag为真时根据输入脉冲数发送脉冲。
- 输入：sysclk,Motor,PulseNum
  - sysclk为系统时钟，上升沿有效；
  - Motor为Input模块输出；
  - PulseNum为Control模块输出。
- 输出：PU,MF,Busy,initFlag
  - PU为脉冲信号，下降沿有效，频率和电机有关；
  - MF为上电信号，高电平有效；
  - Busy为回馈信号，高电平表示正在发送脉冲，对新信号暂时无响应。
  - initFlag为原点标志，为真表示已标定原点。

### Display模块

- 显示输入信息，如电机编号和当前坐标值。

------



## 关于电机

- 二相混合式，20步/周，$18^\circ\pm10^\circ$ /步。

------



## 关于驱动器

- 细分可调，最大128。
- PU：下降沿有效，低0-0.5V，高4-5V，脉宽>2.5us（f<150kHz，考虑到实际，f初始值应当较小），占空比默认为50%。
- DR：控制方向
- MF：低电平有效（断电）
